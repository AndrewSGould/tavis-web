name: Deploy code to VPS

on:
  push:
    branches:
      - deploy

jobs:
  deploy:
    runs-on: ubuntu-latest

    steps:
      - name: Checkout code
        uses: actions/checkout@v2

      - name: Set up SSH password
        run: echo ${{ secrets.SSH_PASSWORD }} > password.txt

      - name: Copy password file to VPS
        run: scp password.txt root@170.249.237.92:~/password.txt

      - name: SSH into VPS and pull code
        run: |
          sshpass -f password.txt ssh root@170.249.237.92 "cd tavis  && git pull"
